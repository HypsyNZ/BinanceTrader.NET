<!--******************************************************************************************************
//  Copyright © 2022, S. Christison. No Rights Reserved.
//
//  Licensed to [You] under one or more License Agreements.
//
//      http://www.opensource.org/licenses/MIT
//
//  Unless agreed to in writing, the subject software distributed under the License is distributed on an
//  "AS-IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//
//******************************************************************************************************-->

<UserControl
    x:Class="BTNET.VM.Controls.ListViewControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:z="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:converters="clr-namespace:BTNET.BV.Converters"
    Name="ListViewC"
    AllowDrop="False">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <converters:NumericFieldConverter x:Key="converter" />
    </UserControl.Resources>
    <UserControl.InputBindings>
        <KeyBinding Key="Delete" Command="{Binding DeleteRowLocalCommand}" />
        <KeyBinding
            Key="C"
            Command="{Binding MainVM.CopySelectedItemToClipboardCommand}"
            Modifiers="Ctrl" />
    </UserControl.InputBindings>
    <ListView
            x:Name="listView1"
            Margin="0.4,0,0,0"
            ItemsSource="{Binding Orders.Current}"
            ScrollViewer.HorizontalScrollBarVisibility="Hidden"
            ScrollViewer.VerticalScrollBarVisibility="Visible"
            SelectedItem="{Binding SelectedListItem}">
        <z:Interaction.Triggers>
            <z:EventTrigger EventName="LostFocus">
                <z:InvokeCommandAction Command="{Binding MainVM.LostFocusCommand}" />
            </z:EventTrigger>
            <z:EventTrigger EventName="GotFocus">
                <z:InvokeCommandAction Command="{Binding MainVM.GotFocusCommand}" />
            </z:EventTrigger>
        </z:Interaction.Triggers>

        <ListView.Resources>
            <ItemsPanelTemplate x:Key="x">
                <VirtualizingStackPanel />
            </ItemsPanelTemplate>
        </ListView.Resources>
        <ListView.View>

            <GridView AllowsColumnReorder="False">
                <GridViewColumn
                        Width="35"
                        DisplayMemberBinding="{Binding Side}"
                        Header="Side" />

                <GridViewColumn
                        Width="130"
                        DisplayMemberBinding="{Binding Fulfilled, UpdateSourceTrigger=PropertyChanged}"
                        Header="Fulfilled" />

                <GridViewColumn
                        Width="95"
                        DisplayMemberBinding="{Binding Price, UpdateSourceTrigger=PropertyChanged}"
                        Header="Price" />

                <GridViewColumn
                        Width="95"
                        DisplayMemberBinding="{Binding Pnl, UpdateSourceTrigger=PropertyChanged, StringFormat='#,0.0###########'}"
                        Header="Run PnL" />

                <GridViewColumn
                        Width="85"
                        DisplayMemberBinding="{Binding MinPos, UpdateSourceTrigger=PropertyChanged, StringFormat='#,0.0###########'}"
                        Header="Min PnL" />

                <GridViewColumn
                        Width="{Binding VisibilityVM.InterestWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        DisplayMemberBinding="{Binding ITDQ, UpdateSourceTrigger=PropertyChanged, StringFormat=' \{0:N8\}'}"
                        Header="ITD Quote" />

                <GridViewColumn
                        Width="{Binding VisibilityVM.InterestWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        DisplayMemberBinding="{Binding ITD, UpdateSourceTrigger=PropertyChanged, StringFormat=' \{0:N8\}'}"
                        Header="ITD Base" />

                <GridViewColumn
                        Width="{Binding VisibilityVM.InterestWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        DisplayMemberBinding="{Binding IPH, UpdateSourceTrigger=PropertyChanged, StringFormat='#,0.0###########'}"
                        Header="Interest/PH" />

                <GridViewColumn
                        Width="{Binding VisibilityVM.InterestWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        DisplayMemberBinding="{Binding IPD, UpdateSourceTrigger=PropertyChanged, StringFormat='#,0.0###########'}"
                        Header="Interest/PD" />

                <GridViewColumn
                        Width="80"
                        DisplayMemberBinding="{Binding Fee, UpdateSourceTrigger=PropertyChanged, StringFormat=' \{0:N8\}'}"
                        Header="Fee (x2)" />

                <GridViewColumn
                        Width="110"
                        DisplayMemberBinding="{Binding CreateTime, StringFormat=dd/MM/yy hh:mm:ss, UpdateSourceTrigger=PropertyChanged}"
                        Header="Date" />

                <!-- <GridViewColumn Width="70" Header="TIF" DisplayMemberBinding="{Binding TimeInForce, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}" />

                    <GridViewColumn Width="80" Header="Status" DisplayMemberBinding="{Binding Status, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}" />

                    <GridViewColumn Width="80" Header="SL/TP" DisplayMemberBinding="{Binding SLTPPrice, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}" />

                    <GridViewColumn Width="80" Header="Iceberg" DisplayMemberBinding="{Binding IcebergQty, UpdateSourceTrigger=PropertyChanged, Mode=OneWay}" />-->

                <GridViewColumn Width="70" Header="Tasks">
                    <GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button
                                    HorizontalAlignment="Left"
                                    Height="16"
                                    Command="{Binding Path=Helper.OrderTasks.BuyCommand}"
                                    CommandParameter="{Binding}"
                                    Content="B"
                                    Margin="0,0,1,0"
                                    TextBlock.FontSize="9"
                                    ToolTipService.ShowDuration="2000"
                                    ToolTip="Buy Filled Amount at Market Price &#x0a; Will NOT Settle Automatically"
                                    Visibility="{Binding Path=Helper.IsOrderSellSide, Converter={StaticResource BoolToVis}}" />
                                <Button
                                    HorizontalAlignment="Left"
                                    Height="16"
                                    Command="{Binding Path=Helper.OrderTasks.BuyAndSettleCommand}"
                                    CommandParameter="{Binding}"
                                    Content="BS"
                                    Margin="0,0,1,0"
                                    TextBlock.FontSize="9"
                                    ToolTipService.ShowDuration="2000"
                                    ToolTip="Buy Filled Amount at Market Price &#x0a;Settles All Base Asset Automatically"
                                    Visibility="{Binding Path=Helper.IsOrderSellSideMargin, Converter={StaticResource BoolToVis}}" />
                                <Button
                                    HorizontalAlignment="Left"
                                    Height="16"
                                    Command="{Binding Path=Helper.OrderTasks.BuyBorrowAndSettleCommand}"
                                    CommandParameter="{Binding}"
                                    Content="BBS"
                                    Margin="0,0,1,0"
                                    TextBlock.FontSize="9"
                                    ToolTipService.ShowDuration="2000"
                                    ToolTip="Buy Filled Amount at Market Price &#x0a;Borrowing If Required &#x0a;Settles All Base Asset Automatically"
                                    Visibility="{Binding Path=Helper.IsOrderSellSideMargin, Converter={StaticResource BoolToVis}}" />

                                <Button
                                    HorizontalAlignment="Left"
                                    Height="16"
                                    Command="{Binding Path=Helper.OrderTasks.SellCommand}"
                                    CommandParameter="{Binding}"
                                    Content="S"
                                    Margin="0,0,1,0"
                                    TextBlock.FontSize="9"
                                    ToolTipService.ShowDuration="2000"
                                    ToolTip="Sell Filled Amount at Market Price &#x0a; Will NOT Settle Automatically"
                                    Visibility="{Binding Path=Helper.IsOrderBuySide, Converter={StaticResource BoolToVis}}" />
                                <Button
                                    HorizontalAlignment="Left"
                                    Height="16"
                                    Command="{Binding Path=Helper.OrderTasks.SellAndSettleCommand}"
                                    CommandParameter="{Binding}"
                                    Content="SS"
                                    Margin="0,0,1,0"
                                    TextBlock.FontSize="9"
                                    ToolTipService.ShowDuration="2000"
                                    ToolTip="Sell Filled Amount at Market Price &#x0a;Settles All Base Asset Automatically"
                                    Visibility="{Binding Path=Helper.IsOrderBuySideMargin, Converter={StaticResource BoolToVis}}" />
                                <Button
                                    HorizontalAlignment="Left"
                                    Height="16"
                                    Command="{Binding Path=Helper.OrderTasks.SellBorrowAndSettleCommand}"
                                    CommandParameter="{Binding}"
                                    Content="SBS"
                                    TextBlock.FontSize="9"
                                    ToolTipService.ShowDuration="2000"
                                    ToolTip="Sell Filled Amount at Market Price &#x0a;Borrowing If Required &#x0a;Settles All Base Asset Automatically"
                                    Visibility="{Binding Path=Helper.IsOrderBuySideMargin, Converter={StaticResource BoolToVis}}" />
                            </StackPanel>
                        </DataTemplate>
                    </GridViewColumn.CellTemplate>
                </GridViewColumn>

                <GridViewColumn Width="{Binding VisibilityVM.ResetInterestWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Header="Reset">
                    <GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <Button
                                    Height="16"
                                    Command="{Binding Path=Helper.ResetInterestCommand}"
                                    CommandParameter="{Binding}"
                                    Content="Interest"
                                    TextBlock.FontSize="9"
                                    ToolTipService.ShowDuration="2000"
                                    ToolTip="Reset the Running Interest on the Order" />
                        </DataTemplate>
                    </GridViewColumn.CellTemplate>
                </GridViewColumn>

                <GridViewColumn Width="50" Header="Cancel">
                    <GridViewColumn.CellTemplate>
                        <DataTemplate>
                            <Button
                                    Height="16"
                                    Command="{Binding Path=Helper.CancelCommand}"
                                    CommandParameter="{Binding}"
                                    Content="Cancel"
                                    TextBlock.FontSize="9"
                                    ToolTipService.ShowDuration="2000"
                                    ToolTip="CANCEL YOUR ORDER"
                                    Visibility="{Binding Path=Helper.CanCancel, Converter={StaticResource BoolToVis}}" />
                        </DataTemplate>
                    </GridViewColumn.CellTemplate>
                </GridViewColumn>

                <GridViewColumn Width="{Binding VisibilityVM.PaddingWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" DisplayMemberBinding="{Binding Helper.TargetNullValue}" />
            </GridView>
        </ListView.View>
    </ListView>
</UserControl>